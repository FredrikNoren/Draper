var logRenderer={};logRenderer.origin=new Vector2(5,200),logRenderer.drawLineBetweenNodes=function(e,t,n){var r=t.position,o=n.position,i=o.sub(r).normalized();r=r.add(i.mul(t.radius+2)),o=o.sub(i.mul(n.radius+2)),e.moveTo(r.x,r.y),e.lineTo(o.x,o.y)},logRenderer.drawArrowLine=function(e,t,n,r){e.setTransform(1,0,0,1,0,0),e.translate(logRenderer.origin.x,logRenderer.origin.y),e.beginPath(),e.moveTo(n.x,n.y+(n.y>t.y?-r:+r)),e.lineTo(t.x,t.y),e.stroke(),e.beginPath(),e.setLineDash([]),e.translate(n.x,n.y),e.rotate(-t.sub(n).angleXY()),e.moveTo(-r,r),e.lineTo(0,0),e.lineTo(r,r),e.closePath(),e.fill()},logRenderer.crossOverNodes=function(e,t){t.forEach(function(t){e.moveTo(t.x()-t.radius(),t.y()-t.radius()),e.lineTo(t.x()+t.radius(),t.y()+t.radius()),e.moveTo(t.x()+t.radius(),t.y()-t.radius()),e.lineTo(t.x()-t.radius(),t.y()+t.radius())})},logRenderer.commitDefaultColor=GitGraphViewModel.randomColor(),logRenderer.render=function(e,t){var n=t.nodes()||[],r=t.nodesById;if(t.refsByRefName,n&&n.length){e.height=n[n.length-1].y()+n[n.length-1].radius()+logRenderer.origin.y;var o=0;n.forEach(function(e){o=Math.max(o,e.x()+e.radius()+logRenderer.origin.x+200)}),e.width=o}else e.height=logRenderer.origin.y+200,e.width=logRenderer.origin.x+200;var i=new Vector2(30,30),a=e.getContext("2d");a.setLineDash||(a.setLineDash=function(){}),a.clearRect(0,0,e.width,e.height),a.translate(logRenderer.origin.x,logRenderer.origin.y);var s,u=t.HEAD(),c={};if(t.hoverGraphAction()&&"rebase"==t.hoverGraphAction().style){var l=t.hoverGraphAction().ref(),p=t.hoverGraphAction().onto();l&&p&&(p instanceof RefViewModel&&(p=p.node()),s=l.node().getPathToCommonAncestor(p),s.slice(0,-1).forEach(function(e){c[e.sha1]=!0}))}a.strokeStyle="#4A4A4A",a.setLineDash([]),a.lineWidth=8,a.beginPath(),n.forEach(function(e){e.parents.forEach(function(t){var n=r[t];n?logRenderer.drawLineBetweenNodes(a,{position:e.position(),radius:e.radius()},{position:n.position(),radius:n.radius()}):logRenderer.drawLineBetweenNodes(a,{position:e.position(),radius:e.radius()},{position:e.position().add(new Vector2(0,1e4)),radius:e.radius()})})}),a.stroke(),u&&(a.beginPath(),a.setLineDash([10,5]),logRenderer.drawLineBetweenNodes(a,{position:i,radius:30},{position:u.position(),radius:u.radius()}),a.stroke()),a.setLineDash([]),n.forEach(function(e){a.fillStyle=c[e.sha1]?"#bbbbbb":e.ideologicalBranch?e.ideologicalBranch.color:"#666666",a.beginPath(),a.arc(e.x(),e.y(),e.radius(),0,2*Math.PI),a.fill()}),a.strokeStyle=u&&u.ideologicalBranch?u.ideologicalBranch.color:logRenderer.commitDefaultColor,a.setLineDash([10,5]),a.lineWidth=7,a.beginPath(),a.arc(i.x,i.y,30-a.lineWidth/2,0,2*Math.PI),a.stroke();var f=16,d=30,h=20,g=[10,5];if(a.lineWidth=7,t.hoverGraphAction()&&"push"==t.hoverGraphAction().style){var m=t.hoverGraphAction().ref();if(m){var y=m.remoteRef();if(y){a.setLineDash(g),a.strokeStyle=a.fillStyle="rgb(61, 139, 255)";var v=h;y.node().y()<m.node().y()&&(v=-v);var b=new Vector2(y.node().x()+y.node().radius()+d,y.node().y()-v),w=new Vector2(m.node().x()+m.node().radius()+d,m.node().y()+v);logRenderer.drawArrowLine(a,b,w,f)}}}if(a.setTransform(1,0,0,1,0,0),a.translate(logRenderer.origin.x,logRenderer.origin.y),t.hoverGraphAction()&&"reset"==t.hoverGraphAction().style){var m=t.hoverGraphAction().ref();if(m){var y=m.remoteRef();a.setLineDash([]),a.strokeStyle="rgb(255, 129, 31)",a.beginPath(),logRenderer.crossOverNodes(a,m.node().getPathToCommonAncestor(y.node()).slice(0,-1)),a.stroke()}}if(t.hoverGraphAction()&&"rebase"==t.hoverGraphAction().style){var l=t.hoverGraphAction().ref(),p=t.hoverGraphAction().onto();if(l&&p){p instanceof RefViewModel&&(p=p.node()),a.setLineDash([]),a.lineWidth=3,a.strokeStyle="#41DE3C";var x=s;a.lineWidth=7,a.setLineDash([10,5]);var k=x.slice(0,-1).map(function(e){return{position:new Vector2(p.x()+(e.x()-_.last(x).x()),p.y()+(e.y()-_.last(x).y())),radius:e.radius()}});k.forEach(function(e){a.beginPath(),a.arc(e.position.x,e.position.y,e.radius-a.lineWidth/2,0,2*Math.PI),a.stroke()});var T={position:p.position(),radius:p.radius()};k.reverse().forEach(function(e){a.beginPath(),a.setLineDash([10,5]),logRenderer.drawLineBetweenNodes(a,e,T),a.stroke(),T=e})}}if(t.hoverGraphAction()&&"merge"==t.hoverGraphAction().style){var l=t.hoverGraphAction().ref(),A=t.hoverGraphAction().mergeWith();if(l&&A){A instanceof RefViewModel&&(A=A.node()),a.setLineDash([10,5]),a.lineWidth=7,a.strokeStyle="#41DE3C";var C={position:new Vector2(l.node().x()+l.node().radius()+(A.x()+A.radius()-(l.node().x()+l.node().radius()))/2,Math.min(l.node().y(),A.y())),radius:Math.max(l.node().radius(),A.radius())};C.position.y-=2*C.radius,a.beginPath(),a.arc(C.position.x,C.position.y,C.radius,0,2*Math.PI),a.stroke(),a.beginPath(),a.setLineDash([10,5]),logRenderer.drawLineBetweenNodes(a,{position:l.node().position(),radius:l.node().radius()},C),logRenderer.drawLineBetweenNodes(a,{position:A.position(),radius:A.radius()},C),a.stroke()}}};