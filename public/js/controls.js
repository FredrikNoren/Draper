"undefined"!=typeof exports&&(ko=require("../vendor/js/knockout-2.2.1.js"));var ProgressBarViewModel=function(e,t,n){var i=this;void 0===t&&(t=1e3),void 0===n&&(n=200),this.progress=ko.observable(),this.running=ko.observable(!1),this.predictionMemoryKey="predict-"+e,this.predictionMs=ko.observable(),this.isFirstRun=ko.observable(!1),this.defaultTimeMs=t,this.elapsedMs=ko.observable(0),this.paused=ko.observable(!1),this.show=ko.computed(function(){return i.isFirstRun()?i.elapsedMs()>n:i.predictionMs()>n}),this.style=ko.computed(function(){return i.isFirstRun()?i.elapsedMs()>n?"animated fadeIn":"":i.predictionMs()>n?"animated fadeIn":void 0})};"undefined"!=typeof exports&&(exports.ProgressBarViewModel=ProgressBarViewModel),ProgressBarViewModel.prototype.start=function(){if(!this.running()){this.running(!0),this.progress(0),this.paused(!1),this.elapsedMs(0),this.lastUpdate=Date.now();var e=localStorage.getItem(this.predictionMemoryKey);!e||isNaN(e)?(this.isFirstRun(!0),e=this.defaultTimeMs):e=parseInt(e),this.predictionMs(e),this.update()}},ProgressBarViewModel.prototype.update=function(){if(this.running()){if(!this.paused()){var e=Date.now(),t=e-this.lastUpdate;this.lastUpdate=e,this.elapsedMs(this.elapsedMs()+t);var n=this.elapsedMs()/this.predictionMs();n=Math.min(1,n),this.progress(n)}window.requestAnimationFrame(this.update.bind(this))}},ProgressBarViewModel.prototype.pause=function(){this.paused(!0)},ProgressBarViewModel.prototype.unpause=function(){this.paused(!1),this.lastUpdate=Date.now()},ProgressBarViewModel.prototype.stop=function(){this.running()&&(this.running(!1),this.lastRealTime=this.elapsedMs(),this.isFirstRun()?(this.isFirstRun(!1),this.predictionMs(this.lastRealTime)):this.predictionMs(.1*this.lastRealTime+.9*this.predictionMs()),localStorage.setItem(this.predictionMemoryKey,this.predictionMs().toString()))};