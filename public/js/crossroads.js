!function(){var e=function(e){function t(e,t){if(e.indexOf)return e.indexOf(t);for(var n=e.length;n--;)if(e[n]===t)return n;return-1}function n(e,n){var i=t(e,n);-1!==i&&e.splice(i,1)}function i(e,t){return"[object "+t+"]"===Object.prototype.toString.call(e)}function o(e){return i(e,"RegExp")}function r(e){return i(e,"Array")}function s(e){return"function"==typeof e}function a(e){var t;return t=null===e||"null"===e?null:"true"===e?!0:"false"===e?!1:e===g||"undefined"===e?g:""===e||isNaN(e)?e:parseFloat(e)}function c(e){for(var t=e.length,n=[];t--;)n[t]=a(e[t]);return n}function d(e,t){for(var n,i,o=(e||"").replace("?","").split("&"),r=o.length,s={};r--;)n=o[r].split("="),i=t?a(n[1]):n[1],s[n[0]]="string"==typeof i?decodeURIComponent(i):i;return s}function p(){this.bypassed=new e.Signal,this.routed=new e.Signal,this._routes=[],this._prevRoutes=[],this._piped=[],this.resetState()}function u(t,n,i,r){var s=o(t),a=r.patternLexer;this._router=r,this._pattern=t,this._paramsIds=s?null:a.getParamIds(t),this._optionalParamsIds=s?null:a.getOptionalParamsIds(t),this._matchRegexp=s?t:a.compilePattern(t,r.ignoreCase),this.matched=new e.Signal,this.switched=new e.Signal,n&&this.matched.add(n),this._priority=i||0}var l,h,g;return h=""===/t(.+)?/.exec("t")[1],p.prototype={greedy:!1,greedyEnabled:!0,ignoreCase:!0,ignoreState:!1,shouldTypecast:!1,normalizeFn:null,resetState:function(){this._prevRoutes.length=0,this._prevMatchedRequest=null,this._prevBypassedRequest=null},create:function(){return new p},addRoute:function(e,t,n){var i=new u(e,t,n,this);return this._sortedInsert(i),i},removeRoute:function(e){n(this._routes,e),e._destroy()},removeAllRoutes:function(){for(var e=this.getNumRoutes();e--;)this._routes[e]._destroy();this._routes.length=0},parse:function(e,t){if(e=e||"",t=t||[],this.ignoreState||e!==this._prevMatchedRequest&&e!==this._prevBypassedRequest){var n,i=this._getMatchedRoutes(e),o=0,r=i.length;if(r)for(this._prevMatchedRequest=e,this._notifyPrevRoutes(i,e),this._prevRoutes=i;r>o;)n=i[o],n.route.matched.dispatch.apply(n.route.matched,t.concat(n.params)),n.isFirst=!o,this.routed.dispatch.apply(this.routed,t.concat([e,n])),o+=1;else this._prevBypassedRequest=e,this.bypassed.dispatch.apply(this.bypassed,t.concat([e]));this._pipeParse(e,t)}},_notifyPrevRoutes:function(e,t){for(var n,i=0;n=this._prevRoutes[i++];)n.route.switched&&this._didSwitch(n.route,e)&&n.route.switched.dispatch(t)},_didSwitch:function(e,t){for(var n,i=0;n=t[i++];)if(n.route===e)return!1;return!0},_pipeParse:function(e,t){for(var n,i=0;n=this._piped[i++];)n.parse(e,t)},getNumRoutes:function(){return this._routes.length},_sortedInsert:function(e){var t=this._routes,n=t.length;do--n;while(t[n]&&e._priority<=t[n]._priority);t.splice(n+1,0,e)},_getMatchedRoutes:function(e){for(var t,n=[],i=this._routes,o=i.length;(t=i[--o])&&((!n.length||this.greedy||t.greedy)&&t.match(e)&&n.push({route:t,params:t._getParamsArray(e)}),this.greedyEnabled||!n.length););return n},pipe:function(e){this._piped.push(e)},unpipe:function(e){n(this._piped,e)},toString:function(){return"[crossroads numRoutes:"+this.getNumRoutes()+"]"}},l=new p,l.VERSION="0.12.0",l.NORM_AS_ARRAY=function(e,t){return[t.vals_]},l.NORM_AS_OBJECT=function(e,t){return[t]},u.prototype={greedy:!1,rules:void 0,match:function(e){return e=e||"",this._matchRegexp.test(e)&&this._validateParams(e)},_validateParams:function(e){var t,n=this.rules,i=this._getParamsObject(e);for(t in n)if("normalize_"!==t&&n.hasOwnProperty(t)&&!this._isValidParam(e,t,i))return!1;return!0},_isValidParam:function(e,n,i){var a=this.rules[n],c=i[n],d=!1,p=0===n.indexOf("?");return null==c&&this._optionalParamsIds&&-1!==t(this._optionalParamsIds,n)?d=!0:o(a)?(p&&(c=i[n+"_"]),d=a.test(c)):r(a)?(p&&(c=i[n+"_"]),d=this._isValidArrayRule(a,c)):s(a)&&(d=a(c,e,i)),d},_isValidArrayRule:function(e,n){if(!this._router.ignoreCase)return-1!==t(e,n);"string"==typeof n&&(n=n.toLowerCase());for(var i,o,r=e.length;r--;)if(i=e[r],o="string"==typeof i?i.toLowerCase():i,o===n)return!0;return!1},_getParamsObject:function(e){for(var n,i,o=this._router.shouldTypecast,r=this._router.patternLexer.getParamValues(e,this._matchRegexp,o),s={},c=r.length;c--;)i=r[c],this._paramsIds&&(n=this._paramsIds[c],0===n.indexOf("?")&&i&&(s[n+"_"]=i,i=d(i,o),r[c]=i),h&&""===i&&-1!==t(this._optionalParamsIds,n)&&(i=void 0,r[c]=i),s[n]=i),s[c]=i;return s.request_=o?a(e):e,s.vals_=r,s},_getParamsArray:function(e){var t,n=this.rules?this.rules.normalize_:null;return n=n||this._router.normalizeFn,t=n&&s(n)?n(e,this._getParamsObject(e)):this._getParamsObject(e).vals_},interpolate:function(e){var t=this._router.patternLexer.interpolate(this._pattern,e);if(!this._validateParams(t))throw new Error("Generated string doesn't validate against `Route.rules`.");return t},dispose:function(){this._router.removeRoute(this)},_destroy:function(){this.matched.dispose(),this.switched.dispose(),this.matched=this.switched=this._pattern=this._matchRegexp=null},toString:function(){return'[Route pattern:"'+this._pattern+'", numListeners:'+this.matched.getNumListeners()+"]"}},p.prototype.patternLexer=function(){function e(){var e,t;for(e in h)h.hasOwnProperty(e)&&(t=h[e],t.id="__CR_"+e+"__",t.save="save"in t?t.save.replace("{{id}}",t.id):t.id,t.rRestore=new RegExp(t.id,"g"))}function t(e,t){var n,i=[];for(e.lastIndex=0;n=e.exec(t);)i.push(n[1]);return i}function n(e){return t(l,e)}function i(e){return t(h.OP.rgx,e)}function o(e,t){return e=e||"",e&&(m===g?e=e.replace(p,""):m===w&&(e=e.replace(u,"")),e=r(e,"rgx","save"),e=e.replace(d,"\\$&"),e=r(e,"rRestore","res"),m===g&&(e="\\/?"+e)),m!==f&&(e+="\\/?"),new RegExp("^"+e+"$",t?"i":"")}function r(e,t,n){var i,o;for(o in h)h.hasOwnProperty(o)&&(i=h[o],e=e.replace(i[t],i[n]));return e}function s(e,t,n){var i=t.exec(e);return i&&(i.shift(),n&&(i=c(i))),i}function a(e,t){if("string"!=typeof e)throw new Error("Route pattern should be a string.");var n=function(e,n){var i;if(n="?"===n.substr(0,1)?n.substr(1):n,null!=t[n]){if("object"==typeof t[n]){var o=[];for(var r in t[n])o.push(encodeURI(r+"="+t[n][r]));i="?"+o.join("&")}else i=String(t[n]);if(-1===e.indexOf("*")&&-1!==i.indexOf("/"))throw new Error('Invalid value "'+i+'" for segment "'+e+'".')}else{if(-1!==e.indexOf("{"))throw new Error("The segment "+e+" is required.");i=""}return i};return h.OS.trail||(h.OS.trail=new RegExp("(?:"+h.OS.id+")+$")),e.replace(h.OS.rgx,h.OS.save).replace(l,n).replace(h.OS.trail,"").replace(h.OS.rRestore,"/")}var d=/[\\.+*?\^$\[\](){}\/'#]/g,p=/^\/|\/$/g,u=/\/$/g,l=/(?:\{|:)([^}:]+)(?:\}|:)/g,h={OS:{rgx:/([:}]|\w(?=\/))\/?(:|(?:\{\?))/g,save:"$1{{id}}$2",res:"\\/?"},RS:{rgx:/([:}])\/?(\{)/g,save:"$1{{id}}$2",res:"\\/"},RQ:{rgx:/\{\?([^}]+)\}/g,res:"\\?([^#]+)"},OQ:{rgx:/:\?([^:]+):/g,res:"(?:\\?([^#]*))?"},OR:{rgx:/:([^:]+)\*:/g,res:"(.*)?"},RR:{rgx:/\{([^}]+)\*\}/g,res:"(.+)"},RP:{rgx:/\{([^}]+)\}/g,res:"([^\\/?]+)"},OP:{rgx:/:([^:]+):/g,res:"([^\\/?]+)?/?"}},g=1,f=2,w=3,m=g;return e(),{strict:function(){m=f},loose:function(){m=g},legacy:function(){m=w},getParamIds:n,getOptionalParamsIds:i,getParamValues:s,compilePattern:o,interpolate:a}}(),l};"function"==typeof define&&define.amd?define(["signals"],e):"undefined"!=typeof module&&module.exports?module.exports=e(require("signals")):window.crossroads=e(window.signals)}();