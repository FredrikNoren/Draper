NodeViewModel=function(e){var t=this;this.graph=e.graph,this.position=ko.observable(new Vector2(0,0)),this.goalPosition=ko.observable(),this.isAtFinalXPosition=ko.computed(function(){return t.goalPosition()?t.position().x==t.goalPosition().x:!0}),this.x=ko.computed(function(){return t.position().x}),this.y=ko.computed(function(){return t.position().y}),this.radius=ko.observable(30),this.goalRadius=ko.observable(),this.boxDisplayX=ko.computed(function(){return t.x()}),this.boxDisplayY=ko.computed(function(){return t.y()}),this.logBoxX=ko.computed(function(){return-t.radius()}),this.refsX=ko.computed(function(){return t.radius()}),this.nodeX=ko.computed(function(){return-t.radius()}),this.nodeY=ko.computed(function(){return-t.radius()}),this.nodeWidth=ko.computed(function(){return 2*t.radius()}),this.nodeHeight=ko.computed(function(){return 2*t.radius()}),this.commitTime=moment(e.commitDate),this.authorTime=moment(e.authorDate),this.parents=e.parents||[];var n=e.message.split("\n");this.message=e.message,this.title=n[0],this.body=n.slice(2).join("\n"),this.sha1=e.sha1,this.authorDate=ko.observable(moment(e.authorDate).fromNow()),setInterval(function(){t.authorDate(moment(e.authorDate).fromNow())},6e4),this.authorName=e.authorName,this.authorEmail=e.authorEmail,this.index=ko.observable(),this.ancestorOfHEAD=ko.observable(!1),this.nodeIsMousehover=ko.observable(!1),this.logBoxVisible=ko.computed(function(){return t.ancestorOfHEAD()&&t.isAtFinalXPosition()||t.nodeIsMousehover()}),this.refs=ko.observable([]),this.branches=ko.computed(function(){return t.refs().filter(function(e){return e.isBranch})}),this.tags=ko.computed(function(){return t.refs().filter(function(e){return e.isTag})}),this.newBranchName=ko.observable(),this.newBranchNameHasFocus=ko.observable(!0),this.newBranchNameHasFocus.subscribe(function(e){e||setTimeout(function(){t.branchingFormVisible(!1)},100)}),this.branchingFormVisible=ko.observable(!1),this.dropareaGraphActions=[new GraphActions.Move(this.graph,this),new GraphActions.Rebase(this.graph,this),new GraphActions.Merge(this.graph,this),new GraphActions.Push(this.graph,this),new GraphActions.Reset(this.graph,this),new GraphActions.Pull(this.graph,this),new GraphActions.Checkout(this.graph,this),new GraphActions.Delete(this.graph,this)]},"undefined"!=typeof exports&&(exports.NodeViewModel=NodeViewModel),NodeViewModel.prototype.setPosition=function(e){var t=this;this.prevPosition=t.position(),t.goalPosition()||t.position(e),t.goalPosition(e)},NodeViewModel.prototype.setRadius=function(e){this.prevRadius=this.radius(),this.goalRadius()||this.radius(e),this.goalRadius(e),this.setRadiusTimestamp=Date.now()},NodeViewModel.prototype.updateAnimationFrame=function(e){var t=500,n=this.goalPosition().sub(this.position()),r=n.length();if(0!=r){n=this.goalPosition().sub(this.prevPosition),n.length();var i=.4*e;if(i>r)this.position(this.goalPosition());else{n=n.normalized().mul(i);var o=this.position().add(n);this.position(o)}}var s=this.goalRadius()-this.radius();if(0!=s){var a=s?0>s?-1:1:0;s=Math.abs(s);var u=Math.abs(this.goalRadius()-this.prevRadius),c=u*e/t;c>s?this.radius(this.goalRadius()):this.radius(this.radius()+a*c)}},NodeViewModel.prototype.showBranchingForm=function(){this.branchingFormVisible(!0),this.newBranchNameHasFocus(!0)},NodeViewModel.prototype.createBranch=function(){api.query("POST","/branches",{path:this.graph.repoPath,name:this.newBranchName(),startPoint:this.sha1}),this.branchingFormVisible(!1),this.newBranchName("")},NodeViewModel.prototype.createTag=function(){api.query("POST","/tags",{path:this.graph.repoPath,name:this.newBranchName(),startPoint:this.sha1}),this.branchingFormVisible(!1),this.newBranchName("")},NodeViewModel.prototype.isAncestor=function(e){if(this.index()>=this.graph.maxNNodes)return!1;if(e==this)return!0;for(var t in this.parents){var n=this.graph.nodesById[this.parents[t]];if(n&&n.isAncestor(e))return!0}return!1},NodeViewModel.prototype.getPathToCommonAncestor=function(e){for(var t=[],n=this;n&&!e.isAncestor(n);)t.push(n),n=this.graph.nodesById[n.parents[0]];return n&&t.push(n),t},NodeViewModel.prototype.nodeMouseover=function(){this.nodeIsMousehover(!0)},NodeViewModel.prototype.nodeMouseout=function(){this.nodeIsMousehover(!1)};